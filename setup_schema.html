<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SabanOS - ×”×ª×§× ×ª ××¡×“ × ×ª×•× ×™×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div class="max-w-2xl w-full bg-gray-800 p-8 rounded-2xl shadow-2xl border border-gray-700">
        <h1 class="text-3xl font-black mb-2 text-teal-400">ğŸ› ï¸ ×”×ª×§× ×ª SabanOS</h1>
        <p class="text-gray-400 mb-6">×›×œ×™ ×–×” ×™×¦×•×¨ ××•×˜×•××˜×™×ª ××ª ×”×˜×‘×œ××•×ª (Collections) ×”× ×“×¨×©×•×ª ×‘-PocketBase.</p>

        <!-- ×”×ª×—×‘×¨×•×ª ××“××™×Ÿ -->
        <div id="loginSection" class="space-y-4">
            <div class="bg-yellow-900/30 p-4 rounded-lg border border-yellow-700 text-yellow-200 text-sm">
                âš ï¸ ×¢×œ×™×š ×œ×”×ª×—×‘×¨ ×¢× ×—×©×‘×•×Ÿ ×”-<b>Admin</b> ×©×™×¦×¨×ª ×‘-PocketBase ×›×“×™ ×œ×‘×¦×¢ ×©×™× ×•×™×™× ×‘××‘× ×” ×”× ×ª×•× ×™×.
            </div>
            <input type="email" id="email" placeholder="Admin Email" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-lg text-white" value="admin@saban.com">
            <input type="password" id="password" placeholder="Admin Password" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-lg text-white">
            <button onclick="loginAndInstall()" class="w-full bg-teal-600 hover:bg-teal-500 text-white font-bold py-3 rounded-lg transition">×”×ª×—×‘×¨ ×•×”×ª×§×Ÿ ×¡×›××”</button>
        </div>

        <!-- ×œ×•×’ ×”×ª×§× ×” -->
        <div id="console" class="hidden mt-6 bg-black p-4 rounded-lg font-mono text-xs h-64 overflow-y-auto text-green-400 border border-gray-700">
            > ××•×›×Ÿ ×œ×”×ª×§× ×”...
        </div>
    </div>

    <script>
        const PB_URL = 'http://127.0.0.1:8090'; // ×•×“× ×©×–×” ×ª×•×× ×œ×©×¨×ª ×©×œ×š
        const pb = new PocketBase(PB_URL);
        const consoleDiv = document.getElementById('console');

        function log(msg, type='info') {
            const color = type === 'error' ? 'text-red-400' : (type === 'success' ? 'text-blue-400' : 'text-green-400');
            consoleDiv.innerHTML += `<div class="${color}">> ${msg}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        async function loginAndInstall() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;

            document.getElementById('loginSection').classList.add('opacity-50', 'pointer-events-none');
            document.getElementById('console').classList.remove('hidden');

            try {
                log("××ª×—×‘×¨ ×œ×©×¨×ª...");
                await pb.admins.authWithPassword(email, pass);
                log("×”×ª×—×‘×¨×•×ª ×”×¦×œ×™×—×”! ××ª×—×™×œ ×‘×”×ª×§× ×”...", "success");
                await createSchema();
            } catch (err) {
                log("×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª: " + err.message, "error");
                document.getElementById('loginSection').classList.remove('opacity-50', 'pointer-events-none');
            }
        }

        async function createSchema() {
            const collections = [
                {
                    name: 'categories',
                    type: 'base',
                    schema: [
                        { name: 'name', type: 'text', required: true },
                        { name: 'icon', type: 'text' },
                        { name: 'slug', type: 'text' } // ××–×”×” ×™×™×—×•×“×™ ×‘×× ×’×œ×™×ª
                    ]
                },
                {
                    name: 'products',
                    type: 'base',
                    schema: [
                        { name: 'title', type: 'text', required: true },
                        { name: 'sku', type: 'text' },
                        { name: 'price', type: 'number' },
                        { name: 'description', type: 'text' },
                        { name: 'image', type: 'url' }, // × ×©×ª××© ×‘-URL ×—×™×¦×•× ×™×™× ×œ× ×•×—×•×ª
                        { name: 'brand', type: 'text' },
                        { name: 'category', type: 'text' }, // × ×©××•×¨ ××ª ×”-ID ×©×œ ×”×§×˜×’×•×¨×™×”
                        { name: 'features', type: 'json' }, // ××¢×¨×š ×ª×›×•× ×•×ª
                        { name: 'technicalSpecs', type: 'json' } // ××•×‘×™×™×§×˜ ××¤×¨×˜ ×˜×›× ×™
                    ]
                },
                {
                    name: 'orders',
                    type: 'base',
                    schema: [
                        { name: 'clientName', type: 'text' },
                        { name: 'clientPhone', type: 'text' },
                        { name: 'items', type: 'json' },
                        { name: 'total', type: 'number' },
                        { name: 'status', type: 'select', options: { values: ['new', 'processing', 'shipped', 'delivered', 'cancelled'] } },
                        { name: 'notes', type: 'text' }
                    ]
                },
                {
                    name: 'chats',
                    type: 'base',
                    schema: [
                        { name: 'customerPhone', type: 'text' },
                        { name: 'messages', type: 'json' },
                        { name: 'status', type: 'select', options: { values: ['open', 'closed'] } }
                    ]
                }
            ];

            for (const col of collections) {
                try {
                    log(`×‘×•×“×§ ×§×•×œ×§×¦×™×”: ${col.name}...`);
                    // × × ×¡×” ×œ×”×‘×™× ××ª ×”×§×•×œ×§×¦×™×” ×›×“×™ ×œ×¨××•×ª ×× ×”×™× ×§×™×™××ª
                    try {
                        await pb.collections.getOne(col.name);
                        log(`âš ï¸ ×§×•×œ×§×¦×™×” ${col.name} ×›×‘×¨ ×§×™×™××ª. ××“×œ×’.`);
                    } catch (e) {
                        // ×× × ×›×©×œ (404), ×¡×™××Ÿ ×©×œ× ×§×™×™××ª -> × ×™×¦×•×¨ ××•×ª×”
                        log(`×™×•×¦×¨ ×§×•×œ×§×¦×™×” ×—×“×©×”: ${col.name}...`);
                        await pb.collections.create({
                            ...col,
                            // ×¤×•×ª×— ××ª ×”×’×™×©×” ×œ×›×•×œ× (×œ×¦×•×¨×š ×”×¤×™×ª×•×—)
                            listRule: "",
                            viewRule: "",
                            createRule: "",
                            updateRule: "",
                            deleteRule: ""
                        });
                        log(`âœ… ${col.name} × ×•×¦×¨×” ×‘×”×¦×œ×—×”!`, "success");
                    }
                } catch (err) {
                    log(`âŒ ×©×’×™××” ×‘- ${col.name}: ${err.message}`, "error");
                }
            }

            // ×™×¦×™×¨×ª × ×ª×•× ×™ ×“×•×’××” (Seed)
            await seedData();

            log("ğŸ ×”×”×ª×§× ×” ×”×¡×ª×™×™××”! ×›×¢×ª × ×™×ª×Ÿ ×œ×”×©×ª××© ×‘××¤×œ×™×§×¦×™×”.", "success");
        }

        async function seedData() {
            log("--- ×™×•×¦×¨ × ×ª×•× ×™ ×”×ª×—×œ×” (×§×˜×’×•×¨×™×•×ª) ---");
            const cats = [
                { name: '×›×œ×œ×™', icon: 'LayoutGrid', slug: 'all' },
                { name: '××œ×™×˜×”', icon: 'Component', slug: 'cement' },
                { name: '×‘×œ×•×§×™×', icon: 'Box', slug: 'blocks' },
                { name: '×¦×‘×¢', icon: 'PaintBucket', slug: 'paint' },
                { name: '×›×œ×™ ×¢×‘×•×“×”', icon: 'Hammer', slug: 'tools' }
            ];

            for (const c of cats) {
                try {
                    // ×™×•×¦×¨ ×¨×§ ×× ××™×Ÿ ×©×’×™××” (×¤×©×˜× ×™)
                    await pb.collection('categories').create(c);
                    log(`× ×•×¦×¨×” ×§×˜×’×•×¨×™×”: ${c.name}`);
                } catch(e) { /* ××ª×¢×œ× ××›×¤×™×œ×•×™×•×ª */ }
            }
        }
    </script>
</body>
</html>
